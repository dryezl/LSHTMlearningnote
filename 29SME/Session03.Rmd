
在本次練習題中，我們學習如何繪製 Kaplan-Meier 生存曲線，並且學會使用 Logrank 檢驗方法來比較不同組之間的生存曲線是否有統計學上的不一致。

## Q1 

打開數據 `trinmlsh`。使用 Stata 的 `describe` 和 `sum` 命令熟悉該數據的各個變量的名字和大致內容。主要是確認一下哪些變量含有重要的結果變量信息，和生存時間信息。`help trinmlsh` 可以調取關於該數據更加詳細的背景和內容介紹。

```{r SME03-01stata,  engine='stata', cache=TRUE, echo=FALSE}
cd "~/Downloads/LSHTMlearningnote/backupfiles/"
use trinmlsh

describe
sum

```


```
help trinmlsh
```

```
COHORT STUDY OF RISK FACTORS FOR MORTALITY AMONG MALES IN TRINIDAD

All males aged 35-74 years who were living in two neighbouring suburbs 
of Port of Spain, Trinidad, in March 1977 were eligible and entered into 
the study. Baseline data were recorded for 1,343 men on a range of risk
factors including ethnic group, blood pressure, glucoose and lipoprotein
concentrations, diabetes mellitus, and cigarette and alchool consumption.

All subjects were then visited annually at home, and morbidity and 
mortality records were compiled.  Regular inspection of hospital records,
death registers and obitaries were also used to update the records.
Those who had moved away (or abroad) were contacted annually by postal
questionnaire and were also seen if they returned to to Port of Spain.
By these means, loss to follow-up was kept very low.

Follow-up of the study cohort finished at the end of 1986, giving a study
period of almost ten years.

The file trinmlsh contains data on selected risk factors for the
subset of men aged 60 years or over.  There were 318 men in this group, and
88 deaths were recorded.  Of these deaths, 22 were attributed to 
 cardiovascular disease.  The file holds the following variables:

ethgp        ethnic group (1=African,2=Indian,3=European,4=mixed,5=Chin/Sem)
ageent       age in years at first survey
death        death from any cause (0=no,1=yes)
cvdeath      death from CV disease (0=no,1=yes)
alc          Drinks per week (0=none,1=1-4,2=5-14,3=15+)
smokenum     No. cigs per day (0=non-sm,1=ex,2=1-9,3=10-19,4=20-29,5=30+)
hdlc         HDL cholesterol
diabp        diastolic BP (mm Hg)
sysbp        systolic BP (mm Hg)
chdstart     heart disease  at time of entry (0=no,1=yes)
days         days of follow-up 
years        years of follow-up 
bmi          body mass index (wt/(ht*ht))
id           Subject identifier
timein       Date of entry (days since 1/1/1960)
timeout      Date of exit  (days since 1/1/1960)
timebth      Date of birth (days since 1/1/1960)
```

我們從數據的簡介和變量名字中不難猜出，`death` 是該研究對象的總死亡結果變量，`cvdeath` 則特別是死於心血管疾病的結果變量。另外 `years` 和 `y` 是內容相同的追蹤時間長度變量，單位是“年”，另一個含有相同信息的時間變量是 `days` “日”。


## Q2

分析該數據中男性的總死亡 `death`，繪製總體人羣的一張 Kaplan-Meier 生存曲線圖。


```{r SME03-02stata,  engine='stata', cache=TRUE, echo=FALSE}
cd "~/Downloads/LSHTMlearningnote/backupfiles/"
use trinmlsh

stset timeout, fail(death) origin(timein) enter(timein) scale(365.25) id(id)
```

在 Stata 繪製 Kaplan-Meier 生存曲線極其簡單：

```
sts graph, saving(plot1)
```


```{r SME03-statafig1, cache=TRUE, fig.width=6, fig.height=5, echo = FALSE, fig.cap="`sts graph, saving(plot1)`", fig.align='center'}
knitr::include_graphics(paste0(bugpath, "/img/plot1.jpg"))
```

