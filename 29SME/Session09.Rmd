
- 這裏主要使用 Stata 的命令，`tabodds` 和 `mhodds` 來進行橫斷面研究的比值 odds 和比值比 odds ratio, OR 的計算。
- 另外需要能夠理解並熟悉 `logistic` 命令和 `logit` 命令計算並比較不同曝露組之間的 OR 和對應的信賴區間。
- 學會使用指示性變量 indicator variable
- 學會使用 `lrtest` 進行似然比檢驗

## Q1-Q2 讀入 `mortality.dta` 數據

數據讀入 Stata 系統之後，使用 `describe` 和 `summarize` 命令來熟悉這個數據。

```{r SME09-01stata,  engine='stata', cache=TRUE, echo=FALSE}
cd "~/Downloads/LSHTMlearningnote/backupfiles/"
use mortality 

describe
summarize
```


## Q3  結果變量 `died`

結果變量是死亡 `died`，編碼爲1 表示受試對象在研究過程中死亡，0則表示對象在研究結束以後仍然存活。用 `tab`, `tabodds` 和 `mhodds` 來簡單分析死亡 `died` 和 `vimp` (視力損傷) 之間的關係。

```
. tab died

       Died |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      4,161       96.81       96.81
          1 |        137        3.19      100.00
------------+-----------------------------------
      Total |      4,298      100.00

. tab vimp

Visually impaired |      Freq.     Percent        Cum.
------------------+-----------------------------------
           Normal |      3,971       92.39       92.39
Visually impaired |        327        7.61      100.00
------------------+-----------------------------------
            Total |      4,298      100.00


. tabulate died vimp, col

+-------------------+
| Key               |
|-------------------|
|     frequency     |
| column percentage |
+-------------------+

           |   Visually impaired
      Died |    Normal  Visually  |     Total
-----------+----------------------+----------
         0 |     3,874        287 |     4,161 
           |     97.56      87.77 |     96.81 
-----------+----------------------+----------
         1 |        97         40 |       137 
           |      2.44      12.23 |      3.19 
-----------+----------------------+----------
     Total |     3,971        327 |     4,298 
           |    100.00     100.00 |    100.00 

. tabodds died vimp

--------------------------------------------------------------------------
      vimp  |      Cases     Controls       Odds      [95% Conf. Interval]
------------+-------------------------------------------------------------
     Normal |         97         3874    0.02504        0.02047   0.03063
  Visuall~d |         40          287    0.13937        0.10012   0.19402
--------------------------------------------------------------------------
Test of homogeneity (equal odds): chi2(1)  =    93.81
                                  Pr>chi2  =   0.0000

Score test for trend of odds:     chi2(1)  =    93.81
                                  Pr>chi2  =   0.0000

. mhodds died vimp

Maximum likelihood estimate of the odds ratio
Comparing vimp==1 vs. vimp==0

    ----------------------------------------------------------------
     Odds Ratio    chi2(1)        P>chi2        [95% Conf. Interval]
    ----------------------------------------------------------------
       5.566292      93.81        0.0000         3.762437   8.234984
    ----------------------------------------------------------------


```

## Q4-5 第一個簡單邏輯回歸模型

用邏輯回歸模型來分析一下 `vimp` 視覺損傷和 `died` 死亡之間的關係。

```
. logit died vimp

Iteration 0:   log likelihood = -606.88457  
Iteration 1:   log likelihood = -578.54009  
Iteration 2:   log likelihood = -577.36856  
Iteration 3:   log likelihood = -577.36596  
Iteration 4:   log likelihood = -577.36596  

Logistic regression                             Number of obs     =      4,298
                                                LR chi2(1)        =      59.04
                                                Prob > chi2       =     0.0000
Log likelihood = -577.36596                     Pseudo R2         =     0.0486

------------------------------------------------------------------------------
        died |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        vimp |   1.716729   .1976151     8.69   0.000     1.329411    2.104048
       _cons |  -3.687332   .1027979   -35.87   0.000    -3.888812   -3.485852
------------------------------------------------------------------------------


```

這裏我們看見 Stata 通過 `iteration` 迭代法找到極大對數似然 -577.36。右邊的模型信息提示有 4298 名實驗對象，另外模型還進行了一個卡方檢驗 $\chi^2 = 59.04$ ，這個檢驗的零假設是“模型中沒有任何一個變量和結果變量（死亡）有關聯性 none of the variables in the model are associated with the outcome variable.”。因爲我們只在模型中加入了一個預測變量 `vimp` 視覺損傷，所以這個零假設也就等同於“視覺損傷與否和死亡之間無相關性。”檢驗的結果很顯然， p<0.0001。`Pseudo R2 = 0.0486` 其實是一個評價模型擬合度的統計量 `goodness of fit statistic`，在這裏我們先忽略它。


## Q6 給出 OR 值

```
. logistic died vimp

Logistic regression                             Number of obs     =      4,298
                                                LR chi2(1)        =      59.04
                                                Prob > chi2       =     0.0000
Log likelihood = -577.36596                     Pseudo R2         =     0.0486

------------------------------------------------------------------------------
        died | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        vimp |   5.566292   1.099983     8.69   0.000     3.778816     8.19929
       _cons |   .0250387   .0025739   -35.87   0.000     .0204696    .0306277
------------------------------------------------------------------------------

```

